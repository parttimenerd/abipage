(function($){"use strict";var console=window.console?window.console:{log:$.noop,error:function(msg){$.error(msg)}};var supportsProp="prop"in $.fn&&"removeProp"in $.fn;function Wysiwyg(){this.controls={bold:{groupIndex:0,visible:true,tags:["b","strong"],css:{fontWeight:"bold"},tooltip:"Bold",hotkey:{ctrl:1,key:66}},copy:{groupIndex:8,visible:false,tooltip:"Copy"},createLink:{groupIndex:6,visible:true,exec:function(){var self=this;if($.wysiwyg.controls&&$.wysiwyg.controls.link){$.wysiwyg.controls.link.init(this)}else{console.error("$.wysiwyg.controls.link not defined. You need to include wysiwyg.link.js file")}},tags:["a"],tooltip:"Create link"},unLink:{groupIndex:6,visible:true,exec:function(){this.editorDoc.execCommand("unlink",false,null)},tooltip:"Remove link"},cut:{groupIndex:8,visible:false,tooltip:"Cut"},decreaseFontSize:{groupIndex:9,visible:false,tags:["small"],tooltip:"Decrease font size",exec:function(){this.decreaseFontSize()}},h1:{groupIndex:7,visible:true,className:"h1",command:$.browser.msie||$.browser.safari?"FormatBlock":"heading",arguments:$.browser.msie||$.browser.safari?"<h1>":"h1",tags:["h1"],tooltip:"Header 1"},h2:{groupIndex:7,visible:true,className:"h2",command:$.browser.msie||$.browser.safari?"FormatBlock":"heading",arguments:$.browser.msie||$.browser.safari?"<h2>":"h2",tags:["h2"],tooltip:"Header 2"},h3:{groupIndex:7,visible:true,className:"h3",command:$.browser.msie||$.browser.safari?"FormatBlock":"heading",arguments:$.browser.msie||$.browser.safari?"<h3>":"h3",tags:["h3"],tooltip:"Header 3"},highlight:{tooltip:"Highlight",className:"highlight",groupIndex:1,visible:false,css:{backgroundColor:"rgb(255, 255, 102)"},exec:function(){var command,node,selection,args;if($.browser.msie||$.browser.safari){command="backcolor"}else{command="hilitecolor"}if($.browser.msie){node=this.getInternalRange().parentElement()}else{selection=this.getInternalSelection();node=selection.extentNode||selection.focusNode;while(node.style===undefined){node=node.parentNode;if(node.tagName&&node.tagName.toLowerCase()==="body"){return}}}if(node.style.backgroundColor==="rgb(255, 255, 102)"||node.style.backgroundColor==="#ffff66"){args="#ffffff"}else{args="#ffff66"}this.editorDoc.execCommand(command,false,args)}},html:{groupIndex:10,visible:false,exec:function(){var elementHeight;if(this.options.resizeOptions&&$.fn.resizable){elementHeight=this.element.height()}if(this.viewHTML){this.setContent(this.original.value);$(this.original).hide();this.editor.show();if(this.options.resizeOptions&&$.fn.resizable){if(elementHeight===this.element.height()){this.element.height(elementHeight+this.editor.height())}this.element.resizable($.extend(true,{alsoResize:this.editor},this.options.resizeOptions))}this.ui.toolbar.find("li").each(function(){var li=$(this);if(li.hasClass("html")){li.removeClass("active")}else{li.removeClass("disabled")}})}else{this.saveContent();$(this.original).css({width:this.element.outerWidth()-6,height:this.element.height()-this.ui.toolbar.height()-6,resize:"none"}).show();this.editor.hide();if(this.options.resizeOptions&&$.fn.resizable){if(elementHeight===this.element.height()){this.element.height(this.ui.toolbar.height())}this.element.resizable("destroy")}this.ui.toolbar.find("li").each(function(){var li=$(this);if(li.hasClass("html")){li.addClass("active")}else{if(false===li.hasClass("fullscreen")){li.removeClass("active").addClass("disabled")}}})}this.viewHTML=!this.viewHTML},tooltip:"View source code"},increaseFontSize:{groupIndex:9,visible:false,tags:["big"],tooltip:"Increase font size",exec:function(){this.increaseFontSize()}},indent:{groupIndex:2,visible:true,tooltip:"Indent"},insertHorizontalRule:{groupIndex:6,visible:true,tags:["hr"],tooltip:"Insert Horizontal Rule"},insertImage:{groupIndex:6,visible:true,exec:function(){var self=this;if($.wysiwyg.controls&&$.wysiwyg.controls.image){$.wysiwyg.controls.image.init(this)}else if($.wysiwyg.autoload){$.wysiwyg.autoload.control("wysiwyg.image.js",function(){self.controls.insertImage.exec.apply(self)})}else{console.error("$.wysiwyg.controls.image not defined. You need to include wysiwyg.image.js file")}},tags:["img"],tooltip:"Insert image"},insertOrderedList:{groupIndex:5,visible:true,tags:["ol"],tooltip:"Insert Ordered List"},insertTable:{groupIndex:6,visible:true,exec:function(){var self=this;if($.wysiwyg.controls&&$.wysiwyg.controls.table){$.wysiwyg.controls.table(this)}else if($.wysiwyg.autoload){$.wysiwyg.autoload.control("wysiwyg.table.js",function(){self.controls.insertTable.exec.apply(self)})}else{console.error("$.wysiwyg.controls.table not defined. You need to include wysiwyg.table.js file")}},tags:["table"],tooltip:"Insert table"},insertUnorderedList:{groupIndex:5,visible:true,tags:["ul"],tooltip:"Insert Unordered List"},italic:{groupIndex:0,visible:true,tags:["i","em"],css:{fontStyle:"italic"},tooltip:"Italic",hotkey:{ctrl:1,key:73}},justifyCenter:{groupIndex:1,visible:true,tags:["center"],css:{textAlign:"center"},tooltip:"Justify Center"},justifyFull:{groupIndex:1,visible:true,css:{textAlign:"justify"},tooltip:"Justify Full"},justifyLeft:{visible:true,groupIndex:1,css:{textAlign:"left"},tooltip:"Justify Left"},justifyRight:{groupIndex:1,visible:true,css:{textAlign:"right"},tooltip:"Justify Right"},ltr:{groupIndex:10,visible:false,exec:function(){var p=this.dom.getElement("p");if(!p){return false}$(p).attr("dir","ltr");return true},tooltip:"Left to Right"},outdent:{groupIndex:2,visible:true,tooltip:"Outdent"},paragraph:{groupIndex:7,visible:false,className:"paragraph",command:"FormatBlock",arguments:$.browser.msie||$.browser.safari?"<p>":"p",tags:["p"],tooltip:"Paragraph"},paste:{groupIndex:8,visible:false,tooltip:"Paste"},redo:{groupIndex:4,visible:true,tooltip:"Redo"},removeFormat:{groupIndex:10,visible:true,exec:function(){this.removeFormat()},tooltip:"Remove formatting"},rtl:{groupIndex:10,visible:false,exec:function(){var p=this.dom.getElement("p");if(!p){return false}$(p).attr("dir","rtl");return true},tooltip:"Right to Left"},strikeThrough:{groupIndex:0,visible:true,tags:["s","strike"],css:{textDecoration:"line-through"},tooltip:"Strike-through"},subscript:{groupIndex:3,visible:true,tags:["sub"],tooltip:"Subscript"},superscript:{groupIndex:3,visible:true,tags:["sup"],tooltip:"Superscript"},underline:{groupIndex:0,visible:true,tags:["u"],css:{textDecoration:"underline"},tooltip:"Underline",hotkey:{ctrl:1,key:85}},undo:{groupIndex:4,visible:true,tooltip:"Undo"},code:{visible:true,groupIndex:6,tooltip:"Code snippet",exec:function(){var range=this.getInternalRange(),common=$(range.commonAncestorContainer),$nodeName=range.commonAncestorContainer.nodeName.toLowerCase();if(common.parent("code").length){common.unwrap()}else{if($nodeName!=="body"){common.wrap("<code/>")}}}},cssWrap:{visible:false,groupIndex:6,tooltip:"CSS Wrapper",exec:function(){$.wysiwyg.controls.cssWrap.init(this)}}};this.defaults={html:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" style="margin:0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body style="margin:0;"></body></html>',debug:false,controls:{},css:{},events:{},autoGrow:false,autoSave:true,brIE:true,formHeight:270,formWidth:440,iFrameClass:null,initialContent:"",maxHeight:1e4,maxLength:0,messages:{nonSelection:"Select the text you wish to link"},toolbarHtml:'<ul role="menu" class="toolbar"></ul>',removeHeadings:false,replaceDivWithP:false,resizeOptions:false,rmUnusedControls:false,rmUnwantedBr:true,tableFiller:"Lorem ipsum",initialMinHeight:null,controlImage:{forceRelativeUrls:false},controlLink:{forceRelativeUrls:false},plugins:{autoload:false,i18n:false,rmFormat:{rmMsWordMarkup:false}},dialog:"default"};this.availableControlProperties=["arguments","callback","className","command","css","custom","exec","groupIndex","hotkey","icon","tags","tooltip","visible"];this.editor=null;this.editorDoc=null;this.element=null;this.options={};this.original=null;this.savedRange=null;this.timers=[];this.validKeyCodes=[8,9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45,46];this.isDestroyed=false;this.dom={ie:{parent:null},w3c:{parent:null}};this.dom.parent=this;this.dom.ie.parent=this.dom;this.dom.w3c.parent=this.dom;this.ui={};this.ui.self=this;this.ui.toolbar=null;this.ui.initialHeight=null;this.dom.getAncestor=function(element,filterTagName){filterTagName=filterTagName.toLowerCase();while(element&&typeof element.tagName!="undefined"&&"body"!==element.tagName.toLowerCase()){if(filterTagName===element.tagName.toLowerCase()){return element}element=element.parentNode}if(!element.tagName&&(element.previousSibling||element.nextSibling)){if(element.previousSibling){if(element.previousSibling.tagName.toLowerCase()==filterTagName){return element.previousSibling}}if(element.nextSibling){if(element.nextSibling.tagName.toLowerCase()==filterTagName){return element.nextSibling}}}return null};this.dom.getElement=function(filterTagName){var dom=this;filterTagName=filterTagName.toLowerCase();if(window.getSelection){return dom.w3c.getElement(filterTagName)}else{return dom.ie.getElement(filterTagName)}};this.dom.ie.getElement=function(filterTagName){var dom=this.parent,selection=dom.parent.getInternalSelection(),range=selection.createRange(),element;if("Control"===selection.type){if(1===range.length){element=range.item(0)}else{return null}}else{element=range.parentElement()}return dom.getAncestor(element,filterTagName)};this.dom.w3c.getElement=function(filterTagName){var dom=this.parent,range=dom.parent.getInternalRange(),element;if(!range){return null}element=range.commonAncestorContainer;if(3===element.nodeType){element=element.parentNode}if(element===range.startContainer){element=element.childNodes[range.startOffset]}if(!element.tagName&&(element.previousSibling||element.nextSibling)){if(element.previousSibling){if(element.previousSibling.tagName.toLowerCase()==filterTagName){return element.previousSibling}}if(element.nextSibling){if(element.nextSibling.tagName.toLowerCase()==filterTagName){return element.nextSibling}}}return dom.getAncestor(element,filterTagName)};this.ui.addHoverClass=function(){$(this).addClass("wysiwyg-button-hover")};this.ui.appendControls=function(){var ui=this,self=this.self,controls=self.parseControls(),hasVisibleControls=true,groups=[],controlsByGroup={},i,currentGroupIndex,iterateGroup=function(controlName,control){if(control.groupIndex&&currentGroupIndex!==control.groupIndex){currentGroupIndex=control.groupIndex;hasVisibleControls=false}if(!control.visible){return}if(!hasVisibleControls){ui.appendItemSeparator();hasVisibleControls=true}if(control.custom){ui.appendItemCustom(controlName,control)}else{ui.appendItem(controlName,control)}};$.each(controls,function(name,c){var index="empty";if(undefined!==c.groupIndex){if(""===c.groupIndex){index="empty"}else{index=c.groupIndex}}if(undefined===controlsByGroup[index]){groups.push(index);controlsByGroup[index]={}}controlsByGroup[index][name]=c});groups.sort(function(a,b){if("number"===typeof a&&typeof a===typeof b){return a-b}else{a=a.toString();b=b.toString();if(a>b){return 1}if(a===b){return 0}return-1}});if(0<groups.length){currentGroupIndex=groups[0]}for(i=0;i<groups.length;i+=1){$.each(controlsByGroup[groups[i]],iterateGroup)}};this.ui.appendItem=function(name,control){var self=this.self,className=control.className||control.command||name||"empty",tooltip=control.tooltip||control.command||name||"";return $('<li role="menuitem" unselectable="on">'+className+"</li>").addClass(className).attr("title",tooltip).hover(this.addHoverClass,this.removeHoverClass).click(function(event){if($(this).hasClass("disabled")){return false}self.triggerControl.apply(self,[name,control]);var $target=$(event.target);for(var controlName in self.controls){if($target.hasClass(controlName)){self.ui.toolbar.find("."+controlName).toggleClass("active");self.editorDoc.rememberCommand=true;break}}this.blur();self.ui.returnRange();self.ui.focus();return true}).appendTo(self.ui.toolbar)};this.ui.appendItemCustom=function(name,control){var self=this.self,tooltip=control.tooltip||control.command||name||"";if(control.callback){$(window).bind("trigger-"+name+".wysiwyg",control.callback)}return $('<li role="menuitem" unselectable="on" style="background: url(\''+control.icon+"') no-repeat;\"></li>").addClass("custom-command-"+name).addClass("wysiwyg-custom-command").addClass(name).attr("title",tooltip).hover(this.addHoverClass,this.removeHoverClass).click(function(){if($(this).hasClass("disabled")){return false}self.triggerControl.apply(self,[name,control]);this.blur();self.ui.returnRange();self.ui.focus();self.triggerControlCallback(name);return true}).appendTo(self.ui.toolbar)};this.ui.appendItemSeparator=function(){var self=this.self;return $('<li role="separator" class="separator"></li>').appendTo(self.ui.toolbar)};this.autoSaveFunction=function(){this.saveContent()};this.ui.checkTargets=function(element){var self=this.self;$.each(self.options.controls,function(name,control){var className=control.className||control.command||name||"empty",tags,elm,css,el,checkActiveStatus=function(cssProperty,cssValue){var handler;if("function"===typeof cssValue){handler=cssValue;if(handler(el.css(cssProperty).toString().toLowerCase(),self)){self.ui.toolbar.find("."+className).addClass("active")}}else{if(el.css(cssProperty).toString().toLowerCase()===cssValue){self.ui.toolbar.find("."+className).addClass("active")}}};if("fullscreen"!==className){self.ui.toolbar.find("."+className).removeClass("active")}if(control.tags||control.options&&control.options.tags){tags=control.tags||control.options&&control.options.tags;elm=element;while(elm){if(elm.nodeType!==1){break}if($.inArray(elm.tagName.toLowerCase(),tags)!==-1){self.ui.toolbar.find("."+className).addClass("active")}elm=elm.parentNode}}if(control.css||control.options&&control.options.css){css=control.css||control.options&&control.options.css;el=$(element);while(el){if(el[0].nodeType!==1){break}$.each(css,checkActiveStatus);el=el.parent()}}})};this.ui.designMode=function(){var attempts=3,self=this.self,runner;runner=function(attempts){if("on"===self.editorDoc.designMode){if(self.timers.designMode){window.clearTimeout(self.timers.designMode)}if(self.innerDocument()!==self.editorDoc){self.ui.initFrame()}return}try{self.editorDoc.designMode="on"}catch(e){}attempts-=1;if(attempts>0){self.timers.designMode=window.setTimeout(function(){runner(attempts)},100)}};runner(attempts)};this.destroy=function(){this.isDestroyed=true;var i,$form=this.element.closest("form");for(i=0;i<this.timers.length;i+=1){window.clearTimeout(this.timers[i])}$form.unbind(".wysiwyg");this.element.remove();$.removeData(this.original,"wysiwyg");$(this.original).show();return this};this.getRangeText=function(){var r=this.getInternalRange();if(r.toString){r=r.toString()}else if(r.text){r=r.text}return r};this.execute=function(command,arg){if(typeof arg==="undefined"){arg=null}this.editorDoc.execCommand(command,false,arg)};this.extendOptions=function(options){var controls={};if("object"===typeof options.controls){controls=options.controls;delete options.controls}options=$.extend(true,{},this.defaults,options);options.controls=$.extend(true,{},controls,this.controls,controls);if(options.rmUnusedControls){$.each(options.controls,function(controlName){if(!controls[controlName]){delete options.controls[controlName]}})}return options};this.ui.focus=function(){var self=this.self;self.editor.get(0).contentWindow.focus();return self};this.ui.returnRange=function(){var self=this.self,sel;if(self.savedRange!==null){if(window.getSelection){sel=window.getSelection();if(sel.rangeCount>0){sel.removeAllRanges()}try{sel.addRange(self.savedRange)}catch(e){console.error(e)}}else if(window.document.createRange){window.getSelection().addRange(self.savedRange)}else if(window.document.selection){self.savedRange.select()}self.savedRange=null}};this.increaseFontSize=function(){if($.browser.mozilla||$.browser.opera){this.editorDoc.execCommand("increaseFontSize",false,null)}else if($.browser.safari){var Range=this.getInternalRange(),Selection=this.getInternalSelection(),newNode=this.editorDoc.createElement("big");if(true===Range.collapsed&&3===Range.commonAncestorContainer.nodeType){var text=Range.commonAncestorContainer.nodeValue.toString(),start=text.lastIndexOf(" ",Range.startOffset)+1,end=-1===text.indexOf(" ",Range.startOffset)?text:text.indexOf(" ",Range.startOffset);Range.setStart(Range.commonAncestorContainer,start);Range.setEnd(Range.commonAncestorContainer,end);Range.surroundContents(newNode);Selection.addRange(Range)}else{Range.surroundContents(newNode);Selection.removeAllRanges();Selection.addRange(Range)}}else{console.error("Internet Explorer?")}};this.decreaseFontSize=function(){if($.browser.mozilla||$.browser.opera){this.editorDoc.execCommand("decreaseFontSize",false,null)}else if($.browser.safari){var Range=this.getInternalRange(),Selection=this.getInternalSelection(),newNode=this.editorDoc.createElement("small");if(true===Range.collapsed&&3===Range.commonAncestorContainer.nodeType){var text=Range.commonAncestorContainer.nodeValue.toString(),start=text.lastIndexOf(" ",Range.startOffset)+1,end=-1===text.indexOf(" ",Range.startOffset)?text:text.indexOf(" ",Range.startOffset);Range.setStart(Range.commonAncestorContainer,start);Range.setEnd(Range.commonAncestorContainer,end);Range.surroundContents(newNode);Selection.addRange(Range)}else{Range.surroundContents(newNode);Selection.removeAllRanges();Selection.addRange(Range)}}else{console.error("Internet Explorer?")}};this.getContent=function(){if(this.viewHTML){this.setContent(this.original.value)}return this.events.filter("getContent",this.editorDoc.body.innerHTML)};this.events={_events:{},bind:function(eventName,callback){if(typeof this._events.eventName!=="object"){this._events[eventName]=[]}this._events[eventName].push(callback)},trigger:function(eventName,args){if(typeof this._events.eventName==="object"){var editor=this.editor;$.each(this._events[eventName],function(k,v){if(typeof v==="function"){v.apply(editor,args)}})}},filter:function(eventName,originalText){if(typeof this._events[eventName]==="object"){var editor=this.editor,args=Array.prototype.slice.call(arguments,1);$.each(this._events[eventName],function(k,v){if(typeof v==="function"){originalText=v.apply(editor,args)}})}return originalText}};this.getElementByAttributeValue=function(tagName,attributeName,attributeValue){var i,value,elements=this.editorDoc.getElementsByTagName(tagName);for(i=0;i<elements.length;i+=1){value=elements[i].getAttribute(attributeName);if($.browser.msie){value=value.substr(value.length-attributeValue.length)}if(value===attributeValue){return elements[i]}}return false};this.getInternalRange=function(){var selection=this.getInternalSelection();if(!selection){return null}if(selection.rangeCount&&selection.rangeCount>0){return selection.getRangeAt(0)}else if(selection.createRange){return selection.createRange()}return null};this.getInternalSelection=function(){if(this.editor.get(0).contentWindow){if(this.editor.get(0).contentWindow.getSelection){return this.editor.get(0).contentWindow.getSelection()}if(this.editor.get(0).contentWindow.selection){return this.editor.get(0).contentWindow.selection}}if(this.editorDoc.getSelection){return this.editorDoc.getSelection()}if(this.editorDoc.selection){return this.editorDoc.selection}return null};this.getRange=function(){var selection=this.getSelection();if(!selection){return null}if(selection.rangeCount&&selection.rangeCount>0){selection.getRangeAt(0)}else if(selection.createRange){return selection.createRange()}return null};this.getSelection=function(){return window.getSelection?window.getSelection():window.document.selection};this.ui.grow=function(){var self=this.self,innerBody=$(self.editorDoc.body),innerHeight=$.browser.msie?innerBody[0].scrollHeight:innerBody.height()+2+20,minHeight=self.ui.initialHeight,height=Math.max(innerHeight,minHeight);height=Math.min(height,self.options.maxHeight);self.editor.attr("scrolling",height<self.options.maxHeight?"no":"auto");innerBody.css("overflow",height<self.options.maxHeight?"hidden":"");self.editor.get(0).height=height;return self};this.init=function(element,options){var self=this,$form=$(element).closest("form"),newX=element.width||element.clientWidth||0,newY=element.height||element.clientHeight||0;this.options=this.extendOptions(options);this.original=element;this.ui.toolbar=$(this.options.toolbarHtml);if($.browser.msie&&parseInt($.browser.version,10)<8){this.options.autoGrow=false}if(newX===0&&element.cols){newX=element.cols*8+21}if(newY===0&&element.rows){newY=element.rows*16+16}this.editor=$(window.location.protocol==="https:"?'<iframe src="javascript:false;"></iframe>':"<iframe></iframe>").attr("frameborder","0");if(this.options.iFrameClass){this.editor.addClass(this.options.iFrameClass)}else{this.editor.css({minHeight:(newY-6).toString()+"px",width:newX>50?newX.toString()+"px":""});if($.browser.msie&&parseInt($.browser.version,10)<7){this.editor.css("height",newY.toString()+"px")}}if(element.id){var proposedId=element.id+"-wysiwyg-iframe";if(!document.getElementById(proposedId)){this.editor.attr("id",proposedId)}}this.editor.attr("tabindex",$(element).attr("tabindex"));this.element=$("<div/>").addClass("wysiwyg");if(!this.options.iFrameClass){this.element.css({width:newX>0?newX.toString()+"px":"100%"})}$(element).hide().before(this.element);this.viewHTML=false;this.initialContent=$(element).val();this.ui.initFrame();if(this.options.resizeOptions&&$.fn.resizable){this.element.resizable($.extend(true,{alsoResize:this.editor},this.options.resizeOptions))}if(this.options.autoSave){$form.bind("submit.wysiwyg",function(){self.autoSaveFunction()})}$form.bind("reset.wysiwyg",function(){self.resetFunction()})};this.ui.initFrame=function(){var self=this.self,stylesheet,growHandler,saveHandler;self.ui.appendControls();self.element.append(self.ui.toolbar).append($("<div><!-- --></div>").css({clear:"both"})).append(self.editor);self.editorDoc=self.innerDocument();if(self.isDestroyed){return null}self.ui.designMode();self.editorDoc.open();self.editorDoc.write(self.options.html.replace(/INITIAL_CONTENT/,function(){return self.wrapInitialContent()}));self.editorDoc.close();$.wysiwyg.plugin.bind(self);$(self.editorDoc).trigger("initFrame.wysiwyg");$(self.editorDoc).bind("click.wysiwyg",function(event){self.ui.checkTargets(event.target?event.target:event.srcElement)});setInterval(function(){var offset=null;try{var range=self.getInternalRange();if(range){offset={range:range,parent:range.endContainer.parentNode,width:range.startOffset-range.endOffset||0}}}catch(e){console.error(e)}if(offset&&offset.width==0&&!self.editorDoc.rememberCommand){self.ui.checkTargets(offset.parent)}},400);$(self.original).focus(function(){if($(this).filter(":visible").length===0||$.browser.opera){return}self.ui.focus()});$(self.editorDoc).keydown(function(event){var emptyContentRegex;if(event.keyCode===8){emptyContentRegex=/^<([\w]+)[^>]*>(<br\/?>)?<\/\1>$/;if(emptyContentRegex.test(self.getContent())){event.stopPropagation();return false}}self.editorDoc.rememberCommand=false;return true});if(!$.browser.msie){$(self.editorDoc).keydown(function(event){var controlName;var control;if(event.ctrlKey||event.metaKey){for(controlName in self.options.controls){control=self.options.controls[controlName];if(control.hotkey&&control.hotkey.ctrl){if(event.keyCode===control.hotkey.key){self.triggerControl.apply(self,[controlName,control]);return false}}}}return true})}else if(self.options.brIE){$(self.editorDoc).keydown(function(event){if(event.keyCode===13){var rng=self.getRange();rng.pasteHTML("<br/>");rng.collapse(false);rng.select();return false}return true})}if(self.options.plugins.rmFormat.rmMsWordMarkup){$(self.editorDoc).bind("keyup.wysiwyg",function(event){if(event.ctrlKey||event.metaKey){if(86===event.keyCode){if($.wysiwyg.rmFormat){if("object"===typeof self.options.plugins.rmFormat.rmMsWordMarkup){$.wysiwyg.rmFormat.run(self,{rules:{msWordMarkup:self.options.plugins.rmFormat.rmMsWordMarkup}})}else{$.wysiwyg.rmFormat.run(self,{rules:{msWordMarkup:{enabled:true}}})}}}}})}if(self.options.autoSave){$(self.editorDoc).keydown(function(){self.autoSaveFunction()}).keyup(function(){self.autoSaveFunction()}).mousedown(function(){self.autoSaveFunction()}).bind($.support.noCloneEvent?"input.wysiwyg":"paste.wysiwyg",function(){self.autoSaveFunction()})}if(self.options.autoGrow){if(self.options.initialMinHeight!==null){self.ui.initialHeight=self.options.initialMinHeight}else{self.ui.initialHeight=$(self.editorDoc).height()}$(self.editorDoc.body).css("border","1px solid white");growHandler=function(){self.ui.grow()};$(self.editorDoc).keyup(growHandler);$(self.editorDoc).bind("editorRefresh.wysiwyg",growHandler);self.ui.grow()}if(self.options.css){if(String===self.options.css.constructor){if($.browser.msie){stylesheet=self.editorDoc.createStyleSheet(self.options.css);$(stylesheet).attr({media:"all"})}else{stylesheet=$("<link/>").attr({href:self.options.css,media:"all",rel:"stylesheet",type:"text/css"});$(self.editorDoc).find("head").append(stylesheet)}}else{self.timers.initFrame_Css=window.setTimeout(function(){$(self.editorDoc.body).css(self.options.css)},0)}}if(self.initialContent.length===0){if("function"===typeof self.options.initialContent){self.setContent(self.options.initialContent())}else{self.setContent(self.options.initialContent)}}if(self.options.maxLength>0){$(self.editorDoc).keydown(function(event){if($(self.editorDoc).text().length>=self.options.maxLength&&$.inArray(event.which,self.validKeyCodes)===-1){event.preventDefault()}})}$.each(self.options.events,function(key,handler){$(self.editorDoc).bind(key+".wysiwyg",function(event){handler.apply(self.editorDoc,[event,self])})});if($.browser.msie){$(self.editorDoc).bind("beforedeactivate.wysiwyg",function(){self.savedRange=self.getInternalRange()})}else{$(self.editorDoc).bind("blur.wysiwyg",function(){self.savedRange=self.getInternalRange()})}$(self.editorDoc.body).addClass("wysiwyg");if(self.options.events&&self.options.events.save){saveHandler=self.options.events.save;$(self.editorDoc).bind("keyup.wysiwyg",saveHandler);$(self.editorDoc).bind("change.wysiwyg",saveHandler);if($.support.noCloneEvent){$(self.editorDoc).bind("input.wysiwyg",saveHandler)}else{$(self.editorDoc).bind("paste.wysiwyg",saveHandler);$(self.editorDoc).bind("cut.wysiwyg",saveHandler)}}if(self.options.xhtml5&&self.options.unicode){var replacements={ne:8800,le:8804,para:182,xi:958,darr:8595,nu:957,oacute:243,Uacute:218,omega:969,prime:8242,pound:163,igrave:236,thorn:254,forall:8704,emsp:8195,lowast:8727,brvbar:166,alefsym:8501,nbsp:160,delta:948,clubs:9827,lArr:8656,Omega:937,Auml:196,cedil:184,and:8743,plusmn:177,ge:8805,raquo:187,uml:168,equiv:8801,laquo:171,rdquo:8221,Epsilon:917,divide:247,fnof:402,chi:967,Dagger:8225,iacute:237,rceil:8969,sigma:963,Oslash:216,acute:180,frac34:190,lrm:8206,upsih:978,Scaron:352,part:8706,exist:8707,nabla:8711,image:8465,prop:8733,zwj:8205,omicron:959,aacute:225,Yuml:376,Yacute:221,weierp:8472,rsquo:8217,otimes:8855,kappa:954,thetasym:977,harr:8596,Ouml:214,Iota:921,ograve:242,sdot:8901,copy:169,oplus:8853,acirc:226,sup:8835,zeta:950,Iacute:205,Oacute:211,crarr:8629,Nu:925,bdquo:8222,lsquo:8216,apos:39,Beta:914,eacute:233,egrave:232,lceil:8968,Kappa:922,piv:982,Ccedil:199,ldquo:8220,Xi:926,cent:162,uarr:8593,hellip:8230,Aacute:193,ensp:8194,sect:167,Ugrave:217,aelig:230,ordf:170,curren:164,sbquo:8218,macr:175,Phi:934,Eta:919,rho:961,Omicron:927,sup2:178,euro:8364,aring:229,Theta:920,mdash:8212,uuml:252,otilde:245,eta:951,uacute:250,rArr:8658,nsub:8836,agrave:224,notin:8713,ndash:8211,Psi:936,Ocirc:212,sube:8838,szlig:223,micro:181,not:172,sup1:185,middot:183,iota:953,ecirc:234,lsaquo:8249,thinsp:8201,sum:8721,ntilde:241,scaron:353,cap:8745,atilde:227,lang:10216,__replacement:65533,isin:8712,gamma:947,Euml:203,ang:8736,upsilon:965,Ntilde:209,hearts:9829,Alpha:913,Tau:932,spades:9824,dagger:8224,THORN:222,"int":8747,lambda:955,Eacute:201,Uuml:220,infin:8734,rlm:8207,Aring:197,ugrave:249,Egrave:200,Acirc:194,rsaquo:8250,ETH:208,oslash:248,alpha:945,Ograve:210,Prime:8243,mu:956,ni:8715,real:8476,bull:8226,beta:946,icirc:238,eth:240,prod:8719,larr:8592,ordm:186,perp:8869,Gamma:915,reg:174,ucirc:251,Pi:928,psi:968,tilde:732,asymp:8776,zwnj:8204,Agrave:192,deg:176,AElig:198,times:215,Delta:916,sim:8764,Otilde:213,Mu:924,uArr:8657,circ:710,theta:952,Rho:929,sup3:179,diams:9830,tau:964,Chi:935,frac14:188,oelig:339,shy:173,or:8744,dArr:8659,phi:966,iuml:239,Lambda:923,rfloor:8971,iexcl:161,cong:8773,ccedil:231,Icirc:206,frac12:189,loz:9674,rarr:8594,cup:8746,radic:8730,frasl:8260,euml:235,OElig:338,hArr:8660,Atilde:195,Upsilon:933,there4:8756,ouml:246,oline:8254,Ecirc:202,yacute:253,auml:228,permil:8240,sigmaf:962,iquest:191,empty:8709,pi:960,Ucirc:219,supe:8839,Igrave:204,yen:165,rang:10217,trade:8482,lfloor:8970,minus:8722,Zeta:918,sub:8834,epsilon:949,yuml:255,Sigma:931,Iuml:207,ocirc:244};self.events.bind("getContent",function(text){return text.replace(/&(?:amp;)?(?!amp|lt|gt|quot)([a-z][a-z0-9]*);/gi,function(str,p1){if(!replacements[p1]){p1=p1.toLowerCase();if(!replacements[p1]){p1="__replacement"}}var num=replacements[p1];return String.fromCharCode(num)})})}$(self.original).trigger("ready.jwysiwyg",[self.editorDoc,self])};this.innerDocument=function(){var element=this.editor.get(0);if(element.nodeName.toLowerCase()==="iframe"){if(element.contentDocument){return element.contentDocument}else if(element.contentWindow){return element.contentWindow.document}if(this.isDestroyed){return null}console.error("Unexpected error in innerDocument")}return element};this.insertHtml=function(szHTML){var img,range;if(!szHTML||szHTML.length===0){return this}if($.browser.msie){this.ui.focus();this.editorDoc.execCommand("insertImage",false,"#jwysiwyg#");img=this.getElementByAttributeValue("img","src","#jwysiwyg#");if(img){$(img).replaceWith(szHTML)}}else{if($.browser.mozilla){if(1===$(szHTML).length){range=this.getInternalRange();range.deleteContents();range.insertNode($(szHTML).get(0))}else{this.editorDoc.execCommand("insertHTML",false,szHTML)}}else{if(!this.editorDoc.execCommand("insertHTML",false,szHTML)){this.editor.focus();this.editorDoc.execCommand("insertHTML",false,szHTML)}}}this.saveContent();return this};this.parseControls=function(){var self=this;$.each(this.options.controls,function(controlName,control){$.each(control,function(propertyName){if(-1===$.inArray(propertyName,self.availableControlProperties)){throw controlName+'["'+propertyName+'"]: property "'+propertyName+'" not exists in Wysiwyg.availableControlProperties'}})});if(this.options.parseControls){return this.options.parseControls.call(this)}return this.options.controls};this.removeFormat=function(){if($.browser.msie){this.ui.focus()}if(this.options.removeHeadings){this.editorDoc.execCommand("formatBlock",false,"<p>")}this.editorDoc.execCommand("removeFormat",false,null);this.editorDoc.execCommand("unlink",false,null);if($.wysiwyg.rmFormat&&$.wysiwyg.rmFormat.enabled){if("object"===typeof this.options.plugins.rmFormat.rmMsWordMarkup){$.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:this.options.plugins.rmFormat.rmMsWordMarkup}})}else{$.wysiwyg.rmFormat.run(this,{rules:{msWordMarkup:{enabled:true}}})}}return this};this.ui.removeHoverClass=function(){$(this).removeClass("wysiwyg-button-hover")};this.resetFunction=function(){this.setContent(this.initialContent)};this.saveContent=function(){if(this.viewHTML){return}if(this.original){var content,newContent;content=this.getContent();if(this.options.rmUnwantedBr){content=content.replace(/<br\/?>$/,"")}if(this.options.replaceDivWithP){newContent=$("<div/>").addClass("temp").append(content);newContent.children("div").each(function(){var element=$(this),p=element.find("p"),i;if(0===p.length){p=$("<p></p>");if(this.attributes.length>0){for(i=0;i<this.attributes.length;i+=1){p.attr(this.attributes[i].name,element.attr(this.attributes[i].name))
}}p.append(element.html());element.replaceWith(p)}});content=newContent.html()}$(this.original).val(content).change();if(this.options.events&&this.options.events.save){this.options.events.save.call(this)}}return this};this.setContent=function(newContent){this.editorDoc.body.innerHTML=newContent;this.saveContent();return this};this.triggerControl=function(name,control){var cmd=control.command||name,args=control["arguments"]||[];if(control.exec){control.exec.apply(this)}else{this.ui.focus();this.ui.withoutCss();try{this.editorDoc.execCommand(cmd,false,args)}catch(e){console.error(e)}}if(this.options.autoSave){this.autoSaveFunction()}};this.triggerControlCallback=function(name){$(window).trigger("trigger-"+name+".wysiwyg",[this])};this.ui.withoutCss=function(){var self=this.self;if($.browser.mozilla){try{self.editorDoc.execCommand("styleWithCSS",false,false)}catch(e){try{self.editorDoc.execCommand("useCSS",false,true)}catch(e2){}}}return self};this.wrapInitialContent=function(){var content=this.initialContent,found=content.match(/<\/?p>/gi);if(!found){return"<p>"+content+"</p>"}else{}return content}}$.wysiwyg={messages:{noObject:"Something goes wrong, check object"},addControl:function(object,name,settings){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg"),customControl={},toolbar;if(!oWysiwyg){return this}customControl[name]=$.extend(true,{visible:true,custom:true},settings);$.extend(true,oWysiwyg.options.controls,customControl);toolbar=$(oWysiwyg.options.toolbarHtml);oWysiwyg.ui.toolbar.replaceWith(toolbar);oWysiwyg.ui.toolbar=toolbar;oWysiwyg.ui.appendControls()})},clear:function(object){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}oWysiwyg.setContent("")})},console:console,destroy:function(object){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}oWysiwyg.destroy()})},document:function(object){var oWysiwyg=object.data("wysiwyg");if(!oWysiwyg){return undefined}return $(oWysiwyg.editorDoc)},getContent:function(object){var oWysiwyg=object.data("wysiwyg");if(!oWysiwyg){return undefined}return oWysiwyg.getContent()},getSelection:function(object){var oWysiwyg=object.data("wysiwyg");if(!oWysiwyg){return undefined}return oWysiwyg.getRangeText()},init:function(object,options){return object.each(function(){var opts=$.extend(true,{},options),obj;if("textarea"!==this.nodeName.toLowerCase()||$(this).data("wysiwyg")){return}obj=new Wysiwyg;obj.init(this,opts);$.data(this,"wysiwyg",obj);$(obj.editorDoc).trigger("afterInit.wysiwyg")})},insertHtml:function(object,szHTML){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}oWysiwyg.insertHtml(szHTML)})},plugin:{listeners:{},bind:function(Wysiwyg){var self=this;$.each(this.listeners,function(action,handlers){var i,plugin;for(i=0;i<handlers.length;i+=1){plugin=self.parseName(handlers[i]);$(Wysiwyg.editorDoc).bind(action+".wysiwyg",{plugin:plugin},function(event){$.wysiwyg[event.data.plugin.name][event.data.plugin.method].apply($.wysiwyg[event.data.plugin.name],[Wysiwyg])})}})},exists:function(name){var plugin;if("string"!==typeof name){return false}plugin=this.parseName(name);if(!$.wysiwyg[plugin.name]||!$.wysiwyg[plugin.name][plugin.method]){return false}return true},listen:function(action,handler){var plugin;plugin=this.parseName(handler);if(!$.wysiwyg[plugin.name]||!$.wysiwyg[plugin.name][plugin.method]){return false}if(!this.listeners[action]){this.listeners[action]=[]}this.listeners[action].push(handler);return true},parseName:function(name){var elements;if("string"!==typeof name){return false}elements=name.split(".");if(2>elements.length){return false}return{name:elements[0],method:elements[1]}},register:function(data){if(!data.name){console.error("Plugin name missing")}$.each($.wysiwyg,function(pluginName){if(pluginName===data.name){console.error("Plugin with name '"+data.name+"' was already registered")}});$.wysiwyg[data.name]=data;return true}},removeFormat:function(object){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}oWysiwyg.removeFormat()})},save:function(object){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}oWysiwyg.saveContent()})},selectAll:function(object){var oWysiwyg=object.data("wysiwyg"),oBody,oRange,selection;if(!oWysiwyg){return this}oBody=oWysiwyg.editorDoc.body;if(window.getSelection){selection=oWysiwyg.getInternalSelection();selection.selectAllChildren(oBody)}else{oRange=oBody.createTextRange();oRange.moveToElementText(oBody);oRange.select()}},setContent:function(object,newContent){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}oWysiwyg.setContent(newContent)})},triggerControl:function(object,controlName){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}if(!oWysiwyg.controls[controlName]){console.error("Control '"+controlName+"' not exists")}oWysiwyg.triggerControl.apply(oWysiwyg,[controlName,oWysiwyg.controls[controlName]])})},support:{prop:supportsProp},utils:{extraSafeEntities:[["<",">","'",'"'," "],[32]],encodeEntities:function(str){var self=this,aStr,aRet=[];if(this.extraSafeEntities[1].length===0){$.each(this.extraSafeEntities[0],function(i,ch){self.extraSafeEntities[1].push(ch.charCodeAt(0))})}aStr=str.split("");$.each(aStr,function(i){var iC=aStr[i].charCodeAt(0);if($.inArray(iC,self.extraSafeEntities[1])&&(iC<65||iC>127||iC>90&&iC<97)){aRet.push("&#"+iC+";")}else{aRet.push(aStr[i])}});return aRet.join("")}}};$.wysiwyg.dialog=function(jWysiwyg,opts){var theme=jWysiwyg&&jWysiwyg.options&&jWysiwyg.options.dialog?jWysiwyg.options.dialog:opts.theme?opts.theme:"default",obj=new $.wysiwyg.dialog.createDialog(theme),that=this,$that=$(that);this.options={modal:true,draggable:true,title:"Title",content:"Content",width:"auto",height:"auto",zIndex:2e3,open:false,close:false};this.isOpen=false;$.extend(this.options,opts);this.object=obj;this.open=function(){this.isOpen=true;obj.init.apply(that,[]);var $dialog=obj.show.apply(that,[]);$that.trigger("afterOpen",[$dialog])};this.show=function(){this.isOpen=true;$that.trigger("beforeShow");var $dialog=obj.show.apply(that,[]);$that.trigger("afterShow")};this.hide=function(){this.isOpen=false;$that.trigger("beforeHide");var $dialog=obj.hide.apply(that,[]);$that.trigger("afterHide",[$dialog])};this.close=function(){this.isOpen=false;var $dialog=obj.hide.apply(that,[]);$that.trigger("beforeClose",[$dialog]);obj.destroy.apply(that,[]);$that.trigger("afterClose",[$dialog]);jWysiwyg.ui.focus()};if(this.options.open){$that.bind("afterOpen",this.options.open)}if(this.options.close){$that.bind("afterClose",this.options.close)}return this};$.extend(true,$.wysiwyg.dialog,{_themes:{},_theme:"",register:function(name,obj){$.wysiwyg.dialog._themes[name]=obj},deregister:function(name){delete $.wysiwyg.dialog._themes[name]},createDialog:function(name){return new $.wysiwyg.dialog._themes[name]},getDimensions:function(){var width=document.body.scrollWidth,height=document.body.scrollHeight;if($.browser.opera){height=Math.max($(document).height(),$(window).height(),document.documentElement.clientHeight)}return[width,height]}});$(function(){if(jQuery.ui){$.wysiwyg.dialog.register("jqueryui",function(){var that=this;this._$dialog=null;this.init=function(){var abstractDialog=this,content=this.options.content;if(typeof content==="object"){if(typeof content.html==="function"){content=content.html()}else if(typeof content.toString==="function"){content=content.toString()}}that._$dialog=$("<div></div>").attr("title",this.options.title).html(content);var dialogHeight=this.options.height=="auto"?300:this.options.height,dialogWidth=this.options.width=="auto"?450:this.options.width;that._$dialog.dialog({modal:this.options.modal,draggable:this.options.draggable,height:dialogHeight,width:dialogWidth});return that._$dialog};this.show=function(){that._$dialog.dialog("open");return that._$dialog};this.hide=function(){that._$dialog.dialog("close");return that._$dialog};this.destroy=function(){that._$dialog.dialog("destroy");return that._$dialog}})}$.wysiwyg.dialog.register("default",function(){var that=this;this._$dialog=null;this.init=function(){var abstractDialog=this,content=this.options.content;if(typeof content==="object"){if(typeof content.html==="function"){content=content.html()}else if(typeof content.toString==="function"){content=content.toString()}}that._$dialog=$('<div class="wysiwyg-dialog"></div>').css({"z-index":this.options.zIndex});var $topbar=$('<div class="wysiwyg-dialog-topbar"><div class="wysiwyg-dialog-close-wrapper"></div><div class="wysiwyg-dialog-title">'+this.options.title+"</div></div>");var $link=$('<a href="#" class="wysiwyg-dialog-close-button">X</a>');$link.click(function(){abstractDialog.close()});$topbar.find(".wysiwyg-dialog-close-wrapper").prepend($link);var $dcontent=$('<div class="wysiwyg-dialog-content">'+content+"</div>");that._$dialog.append($topbar).append($dcontent);var dialogHeight=this.options.height=="auto"?300:this.options.height,dialogWidth=this.options.width=="auto"?450:this.options.width;that._$dialog.hide().css({width:dialogWidth,height:dialogHeight,left:($(window).width()-dialogWidth)/2,top:($(window).height()-dialogHeight)/3});$("body").append(that._$dialog);return that._$dialog};this.show=function(){if(this.options.modal){var dimensions=$.wysiwyg.dialog.getDimensions(),wrapper=$('<div class="wysiwyg-dialog-modal-div"></div>').css({width:dimensions[0],height:dimensions[1]});that._$dialog.wrap(wrapper)}if(this.options.draggable){var mouseDown=false;that._$dialog.find("div.wysiwyg-dialog-topbar").bind("mousedown",function(e){e.preventDefault();$(this).css({cursor:"move"});var $topbar=$(this),_dialog=$(this).parents(".wysiwyg-dialog"),offsetX=e.pageX-parseInt(_dialog.css("left"),10),offsetY=e.pageY-parseInt(_dialog.css("top"),10);mouseDown=true;$(this).css({cursor:"move"});$(document).bind("mousemove",function(e){e.preventDefault();if(mouseDown){_dialog.css({top:e.pageY-offsetY,left:e.pageX-offsetX})}}).bind("mouseup",function(e){e.preventDefault();mouseDown=false;$topbar.css({cursor:"auto"});$(document).unbind("mousemove").unbind("mouseup")})})}that._$dialog.show();return that._$dialog};this.hide=function(){that._$dialog.hide();return that._$dialog};this.destroy=function(){if(this.options.modal){that._$dialog.unwrap()}if(this.options.draggable){that._$dialog.find("div.wysiwyg-dialog-topbar").unbind("mousedown")}that._$dialog.remove();return that._$dialog}})});$.fn.wysiwyg=function(method){var args=arguments,plugin;if("undefined"!==typeof $.wysiwyg[method]){args=Array.prototype.concat.call([args[0]],[this],Array.prototype.slice.call(args,1));return $.wysiwyg[method].apply($.wysiwyg,Array.prototype.slice.call(args,1))}else if("object"===typeof method||!method){Array.prototype.unshift.call(args,this);return $.wysiwyg.init.apply($.wysiwyg,args)}else if($.wysiwyg.plugin.exists(method)){plugin=$.wysiwyg.plugin.parseName(method);args=Array.prototype.concat.call([args[0]],[this],Array.prototype.slice.call(args,1));return $.wysiwyg[plugin.name][plugin.method].apply($.wysiwyg[plugin.name],Array.prototype.slice.call(args,1))}else{console.error("Method '"+method+"' does not exist on jQuery.wysiwyg.\nTry to include some extra controls or plugins")}};$.fn.getWysiwyg=function(){return this.data("wysiwyg")}})(jQuery);(function($){if(undefined===$.wysiwyg){throw"wysiwyg.i18n.js depends on $.wysiwyg"}var i18n={name:"i18n",version:"",defaults:{lang:"en",wysiwygLang:"en"},lang:{},options:{},init:function(Wysiwyg,lang){if(!Wysiwyg.options.plugins[this.name]){return true}this.options=$.extend(true,this.defaults,Wysiwyg.options.plugins[this.name]);if(lang){this.options.lang=lang}else{lang=this.options.lang}if(lang!==this.options.wysiwygLang&&undefined===$.wysiwyg.i18n.lang[lang]){if($.wysiwyg.autoload){$.wysiwyg.autoload.lang("lang."+lang+".js",function(){$.wysiwyg.i18n.init(Wysiwyg,lang)})}else{throw'Language "'+lang+'" not found in $.wysiwyg.i18n. You need to include this language file'}}this.translateControls(Wysiwyg,lang)},translateControls:function(Wysiwyg,lang){Wysiwyg.ui.toolbar.find("li").each(function(){if(Wysiwyg.options.controls[$(this).attr("class")]&&Wysiwyg.options.controls[$(this).attr("class")].visible){$(this).attr("title",$.wysiwyg.i18n.t(Wysiwyg.options.controls[$(this).attr("class")].tooltip,"controls",lang))}})},run:function(object,lang){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg");if(!oWysiwyg){return this}$.wysiwyg.i18n.init(oWysiwyg,lang)})},t:function(phrase,section,lang){var i,section_array,transObject;if(!lang){lang=this.options.lang}if(lang===this.options.wysiwygLang||!this.lang[lang]){return phrase}transObject=this.lang[lang];section_array=section.split(".");for(i=0;i<section_array.length;i+=1){if(transObject[section_array[i]]){transObject=transObject[section_array[i]]}}if(transObject[phrase]){return transObject[phrase]}return phrase}};$.wysiwyg.plugin.register(i18n);$.wysiwyg.plugin.listen("initFrame","i18n.init")})(jQuery);(function($){if(undefined===$.wysiwyg){throw"lang.de.js depends on $.wysiwyg"}if(undefined===$.wysiwyg.i18n){throw"lang.de.js depends on $.wysiwyg.i18n"}$.wysiwyg.i18n.lang.de={controls:{Bold:"Fett",Colorpicker:"Farbe wählen",Copy:"Kopieren","Create link":"Link erstellen",Cut:"Ausschneiden","Decrease font size":"Schriftgröße verkleinern",Fullscreen:"Vollbild","Header 1":"Überschrift 1","Header 2":"Überschrift 2","Header 3":"Überschrift 3","View source code":"Quellcode anzeigen","Increase font size":"Schriftgröße vergrößern",Indent:"Einrücken","Insert Horizontal Rule":"Horizontalen Trennbalken einfügen","Insert image":"Bild einfügen","Insert Ordered List":"Nummerierte Liste einfügen","Insert table":"Tabelle einfügen","Insert Unordered List":"Unnummerierte Liste einfügen",Italic:"Kursiv","Justify Center":"Zentrieren","Justify Full":"Blocksatz","Justify Left":"Links ausrichten","Justify Right":"Rechts ausrichten","Left to Right":"Links nach Rechts",Outdent:"Einrückung zurücknehmen",Paste:"Einfügen",Redo:"Wiederherstellen","Remove formatting":"Formatierung entfernen","Right to Left":"Rechts nach Links","Strike-through":"Durchstreichen",Subscript:"Tiefstellen",Superscript:"Hochstellen",Underline:"Unterstreichen",Undo:"Rückgängig"},dialogs:{Apply:"Anwenden",Cancel:"Abbrechen",colorpicker:{Colorpicker:"Farbwähler",Color:"Farbe"},image:{"Insert Image":"Bild einfügen",Preview:"Vorschau",URL:"URL",Title:"Titel",Description:"Beschreibung",Width:"Breite",Height:"Höhe","Original W x H":"Original W x H",Float:"",None:"",Left:"",Right:""},link:{"Insert Link":"Link einfügen","Link URL":"Link URL","Link Title":"Link Titel","Link Target":"Link Ziel"},table:{"Insert table":"Tabelle einfügen","Count of columns":"Spaltenanzahl","Count of rows":"Zeilenanzahl"}}}})(jQuery);(function($){if(undefined===$.wysiwyg){throw"wysiwyg.fullscreen.js depends on $.wysiwyg"}var fullscreen={name:"fullscreen",version:"",defaults:{css:{editor:{width:"100%",height:"100%"},element:{width:"100%",height:"100%",position:"fixed",left:"0px",top:"0px",background:"rgb(255, 255, 255)",padding:"0px","border-bottom-color":"","border-bottom-style":"","border-bottom-width":"0px","border-left-color":"","border-left-style":"","border-left-width":"0px","border-right-color":"","border-right-style":"","border-right-width":"0px","border-top-color":"","border-top-style":"","border-top-width":"0px","z-index":1e3},original:{width:"100%",height:"100%",position:"fixed",left:"0px",top:"0px",background:"rgb(255, 255, 255)",padding:"0px","border-bottom-color":"","border-bottom-style":"","border-bottom-width":"0px","border-left-color":"","border-left-style":"","border-left-width":"0px","border-right-color":"","border-right-style":"","border-right-width":"0px","border-top-color":"","border-top-style":"","border-top-width":"0px","z-index":1e3}}},options:{},originalBoundary:{editor:{},element:{},original:{}},init:function(Wysiwyg,options){options=options||{};this.options=$.extend(true,this.defaults,options);if(Wysiwyg.ui.toolbar.find(".fullscreen").hasClass("active")){this.restore(Wysiwyg);Wysiwyg.ui.toolbar.find(".fullscreen").removeClass("active")}else{this.stretch(Wysiwyg);Wysiwyg.ui.toolbar.find(".fullscreen").addClass("active")}},restore:function(Wysiwyg){var propertyName;for(propertyName in this.defaults.css.editor){Wysiwyg.editor.css(propertyName,this.originalBoundary.editor[propertyName]);this.originalBoundary.editor[propertyName]=null}for(propertyName in this.defaults.css.element){Wysiwyg.element.css(propertyName,this.originalBoundary.element[propertyName]);this.originalBoundary.element[propertyName]=null}for(propertyName in this.defaults.css.original){$(Wysiwyg.original).css(propertyName,this.originalBoundary.original[propertyName]);this.originalBoundary.original[propertyName]=null}},stretch:function(Wysiwyg){var propertyName;for(propertyName in this.defaults.css.editor){this.originalBoundary.editor[propertyName]=Wysiwyg.editor.css(propertyName)}for(propertyName in this.defaults.css.element){this.originalBoundary.element[propertyName]=Wysiwyg.element.css(propertyName)}for(propertyName in this.defaults.css.original){this.originalBoundary.original[propertyName]=$(Wysiwyg.original).css(propertyName)}for(propertyName in this.defaults.css.editor){Wysiwyg.editor.css(propertyName,this.options.css.editor[propertyName])}for(propertyName in this.defaults.css.element){Wysiwyg.element.css(propertyName,this.options.css.element[propertyName])}this.options.css.original.top=Wysiwyg.ui.toolbar.css("height");for(propertyName in this.defaults.css.original){$(Wysiwyg.original).css(propertyName,this.options.css.original[propertyName])}}};$.wysiwyg.plugin.register(fullscreen)})(jQuery);(function($){"use strict";if(undefined===$.wysiwyg){throw"wysiwyg.table.js depends on $.wysiwyg"}if(!$.wysiwyg.controls){$.wysiwyg.controls={}}var insertTable=function(colCount,rowCount,filler){if(isNaN(rowCount)||isNaN(colCount)||rowCount===null||colCount===null){return}var i,j,html=['<table border="1" style="width: 100%;"><tbody>'];colCount=parseInt(colCount,10);rowCount=parseInt(rowCount,10);if(filler===null){filler="&nbsp;"}filler="<td>"+filler+"</td>";for(i=rowCount;i>0;i-=1){html.push("<tr>");for(j=colCount;j>0;j-=1){html.push(filler)}html.push("</tr>")}html.push("</tbody></table>");return this.insertHtml(html.join(""))};$.wysiwyg.controls.table=function(Wysiwyg){var adialog,dialog,colCount,rowCount,formTableHtml,dialogReplacements,key,translation,regexp;dialogReplacements={legend:"Insert table",cols:"Count of columns",rows:"Count of rows",submit:"Insert table",reset:"Cancel"};formTableHtml='<form class="wysiwyg" id="wysiwyg-tableInsert"><fieldset><legend>{legend}</legend>'+'<label>{cols}: <input type="text" name="colCount" value="3" /></label><br/>'+'<label>{rows}: <input type="text" name="rowCount" value="3" /></label><br/>'+'<input type="submit" class="button" value="{submit}"/> '+'<input type="reset" value="{reset}"/></fieldset></form>';for(key in dialogReplacements){if($.wysiwyg.i18n){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs.table");if(translation===dialogReplacements[key]){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs")}dialogReplacements[key]=translation}regexp=new RegExp("{"+key+"}","g");formTableHtml=formTableHtml.replace(regexp,dialogReplacements[key])}if(!Wysiwyg.insertTable){Wysiwyg.insertTable=insertTable}adialog=new $.wysiwyg.dialog(Wysiwyg,{title:dialogReplacements.legend,content:formTableHtml,open:function(e,dialog){dialog.find("form#wysiwyg-tableInsert").submit(function(e){e.preventDefault();rowCount=dialog.find("input[name=rowCount]").val();colCount=dialog.find("input[name=colCount]").val();Wysiwyg.insertTable(colCount,rowCount,Wysiwyg.defaults.tableFiller);adialog.close();return false});dialog.find("input:reset").click(function(e){e.preventDefault();adialog.close();return false})}});adialog.open();$(Wysiwyg.editorDoc).trigger("editorRefresh.wysiwyg")};$.wysiwyg.insertTable=function(object,colCount,rowCount,filler){return object.each(function(){var Wysiwyg=$(this).data("wysiwyg");if(!Wysiwyg.insertTable){Wysiwyg.insertTable=insertTable}if(!Wysiwyg){return this}Wysiwyg.insertTable(colCount,rowCount,filler);$(Wysiwyg.editorDoc).trigger("editorRefresh.wysiwyg");return this})}})(jQuery);(function($){"use strict";if(undefined===$.wysiwyg){throw"wysiwyg.link.js depends on $.wysiwyg"}if(!$.wysiwyg.controls){$.wysiwyg.controls={}}$.wysiwyg.controls.link={init:function(Wysiwyg){var self=this,elements,dialog,url,a,selection,formLinkHtml,dialogReplacements,key,translation,regexp,baseUrl,img;dialogReplacements={legend:"Insert Link",url:"Link URL",title:"Link Title",target:"Link Target",submit:"Insert Link",reset:"Cancel"};formLinkHtml='<form class="wysiwyg"><fieldset><legend>{legend}</legend>'+'<label>{url}: <input type="text" name="linkhref" value=""/></label>'+'<label>{title}: <input type="text" name="linktitle" value=""/></label>'+'<label>{target}: <input type="text" name="linktarget" value=""/></label>'+'<input type="submit" class="button" value="{submit}"/> '+'<input type="reset" value="{reset}"/></fieldset></form>';for(key in dialogReplacements){if($.wysiwyg.i18n){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs.link");if(translation===dialogReplacements[key]){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs")}dialogReplacements[key]=translation}regexp=new RegExp("{"+key+"}","g");formLinkHtml=formLinkHtml.replace(regexp,dialogReplacements[key])}a={self:Wysiwyg.dom.getElement("a"),href:"http://",title:"",target:""};if(a.self){a.href=a.self.href?a.self.href:a.href;a.title=a.self.title?a.self.title:"";a.target=a.self.target?a.self.target:""}if($.fn.dialog){elements=$(formLinkHtml);elements.find("input[name=linkhref]").val(a.href);elements.find("input[name=linktitle]").val(a.title);elements.find("input[name=linktarget]").val(a.target);if($.browser.msie){try{dialog=elements.appendTo(Wysiwyg.editorDoc.body)}catch(err){dialog=elements.appendTo("body")}}else{dialog=elements.appendTo("body")}dialog.dialog({modal:true,open:function(ev,ui){$("input:submit",dialog).click(function(e){e.preventDefault();var url=$('input[name="linkhref"]',dialog).val(),title=$('input[name="linktitle"]',dialog).val(),target=$('input[name="linktarget"]',dialog).val(),baseUrl,img;if(Wysiwyg.options.controlLink.forceRelativeUrls){baseUrl=window.location.protocol+"//"+window.location.hostname;if(0===url.indexOf(baseUrl)){url=url.substr(baseUrl.length)}}if(a.self){if("string"===typeof url){if(url.length>0){$(a.self).attr("href",url).attr("title",title).attr("target",target)}else{$(a.self).replaceWith(a.self.innerHTML)}}}else{if($.browser.msie){Wysiwyg.ui.returnRange()}selection=Wysiwyg.getRangeText();img=Wysiwyg.dom.getElement("img");if(selection&&selection.length>0||img){if($.browser.msie){Wysiwyg.ui.focus()}if("string"===typeof url){if(url.length>0){Wysiwyg.editorDoc.execCommand("createLink",false,url)}else{Wysiwyg.editorDoc.execCommand("unlink",false,null)}}a.self=Wysiwyg.dom.getElement("a");$(a.self).attr("href",url).attr("title",title);$(a.self).attr("target",target)}else if(Wysiwyg.options.messages.nonSelection){window.alert(Wysiwyg.options.messages.nonSelection)}}Wysiwyg.saveContent();$(dialog).dialog("close")});$("input:reset",dialog).click(function(e){e.preventDefault();$(dialog).dialog("close")})},close:function(ev,ui){dialog.dialog("destroy");dialog.remove()}})}else{if(a.self){url=window.prompt("URL",a.href);if(Wysiwyg.options.controlLink.forceRelativeUrls){baseUrl=window.location.protocol+"//"+window.location.hostname;if(0===url.indexOf(baseUrl)){url=url.substr(baseUrl.length)}}if("string"===typeof url){if(url.length>0){$(a.self).attr("href",url)}else{$(a.self).replaceWith(a.self.innerHTML)}}}else{selection=Wysiwyg.getRangeText();img=Wysiwyg.dom.getElement("img");if(selection&&selection.length>0||img){if($.browser.msie){Wysiwyg.ui.focus();Wysiwyg.editorDoc.execCommand("createLink",true,null)}else{url=window.prompt(dialogReplacements.url,a.href);if(Wysiwyg.options.controlLink.forceRelativeUrls){baseUrl=window.location.protocol+"//"+window.location.hostname;if(0===url.indexOf(baseUrl)){url=url.substr(baseUrl.length)}}if("string"===typeof url){if(url.length>0){Wysiwyg.editorDoc.execCommand("createLink",false,url)}else{Wysiwyg.editorDoc.execCommand("unlink",false,null)}}}}else if(Wysiwyg.options.messages.nonSelection){window.alert(Wysiwyg.options.messages.nonSelection)}}Wysiwyg.saveContent()}$(Wysiwyg.editorDoc).trigger("editorRefresh.wysiwyg")}};$.wysiwyg.createLink=function(object,url){return object.each(function(){var oWysiwyg=$(this).data("wysiwyg"),selection;if(!oWysiwyg){return this}if(!url||url.length===0){return this}selection=oWysiwyg.getRangeText();if(selection&&selection.length>0){if($.browser.msie){oWysiwyg.ui.focus()}oWysiwyg.editorDoc.execCommand("unlink",false,null);oWysiwyg.editorDoc.execCommand("createLink",false,url)}else if(oWysiwyg.options.messages.nonSelection){window.alert(oWysiwyg.options.messages.nonSelection)}return this})}})(jQuery);(function($){"use strict";if(undefined===$.wysiwyg){throw"wysiwyg.image.js depends on $.wysiwyg"}if(!$.wysiwyg.controls){$.wysiwyg.controls={}}$.wysiwyg.controls.image={groupIndex:6,visible:true,exec:function(){$.wysiwyg.controls.image.init(this)},tags:["img"],tooltip:"Insert image",init:function(Wysiwyg){var self=this,elements,adialog,dialog,formImageHtml,regexp,dialogReplacements,key,translation,img={alt:"",self:Wysiwyg.dom?Wysiwyg.dom.getElement("img"):null,src:"http://",title:""};dialogReplacements={legend:"Insert Image",preview:"Preview",url:"URL",title:"Title",description:"Description",width:"Width",height:"Height",original:"Original W x H","float":"Float",floatNone:"None",floatLeft:"Left",floatRight:"Right",submit:"Insert Image",reset:"Cancel",fileManagerIcon:"Select file from server"};formImageHtml='<form class="wysiwyg" id="wysiwyg-addImage"><fieldset>'+'<div class="form-row"><span class="form-row-key">{preview}:</span><div class="form-row-value"><img src="" alt="{preview}" style="margin: 2px; padding:5px; max-width: 100%; overflow:hidden; max-height: 100px; border: 1px solid rgb(192, 192, 192);"/></div></div>'+'<div class="form-row"><label for="name">{url}:</label><div class="form-row-value"><input type="text" name="src" value=""/>';if($.wysiwyg.fileManager&&$.wysiwyg.fileManager.ready){formImageHtml+='<div class="wysiwyg-fileManager" title="{fileManagerIcon}"/>'}formImageHtml+="</div></div>"+'<div class="form-row"><label for="name">{title}:</label><div class="form-row-value"><input type="text" name="imgtitle" value=""/></div></div>'+'<div class="form-row"><label for="name">{description}:</label><div class="form-row-value"><input type="text" name="description" value=""/></div></div>'+'<div class="form-row"><label for="name">{width} x {height}:</label><div class="form-row-value"><input type="text" name="width" value="" class="width-small"/> x <input type="text" name="height" value="" class="width-small"/></div></div>'+'<div class="form-row"><label for="name">{original}:</label><div class="form-row-value"><input type="text" name="naturalWidth" value="" class="width-small" disabled="disabled"/> x '+'<input type="text" name="naturalHeight" value="" class="width-small" disabled="disabled"/></div></div>'+'<div class="form-row"><label for="name">{float}:</label><div class="form-row-value"><select name="float">'+'<option value="">{floatNone}</option>'+'<option value="left">{floatLeft}</option>'+'<option value="right">{floatRight}</option></select></div></div>'+'<div class="form-row form-row-last"><label for="name"></label><div class="form-row-value"><input type="submit" class="button" value="{submit}"/> '+'<input type="reset" value="{reset}"/></div></div></fieldset></form>';for(key in dialogReplacements){if($.wysiwyg.i18n){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs.image");if(translation===dialogReplacements[key]){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs")}dialogReplacements[key]=translation}regexp=new RegExp("{"+key+"}","g");formImageHtml=formImageHtml.replace(regexp,dialogReplacements[key])}if(img.self){img.src=img.self.src?img.self.src:"";img.alt=img.self.alt?img.self.alt:"";img.title=img.self.title?img.self.title:"";img.width=img.self.width?img.self.width:"";img.height=img.self.height?img.self.height:"";img.styleFloat=$(img.self).css("float")}adialog=new $.wysiwyg.dialog(Wysiwyg,{title:dialogReplacements.legend,content:formImageHtml});$(adialog).bind("afterOpen",function(e,dialog){dialog.find("form#wysiwyg-addImage").submit(function(e){e.preventDefault();self.processInsert(dialog.container,Wysiwyg,img);adialog.close();return false});if($.wysiwyg.fileManager){$("div.wysiwyg-fileManager").bind("click",function(){$.wysiwyg.fileManager.init(function(selected){dialog.find("input[name=src]").val(selected);dialog.find("input[name=src]").trigger("change")})})}$("input:reset",dialog).click(function(e){adialog.close();return false});$("fieldset",dialog).click(function(e){e.stopPropagation()});self.makeForm(dialog,img)});adialog.open();$(Wysiwyg.editorDoc).trigger("editorRefresh.wysiwyg")},processInsert:function(context,Wysiwyg,img){var image,url=$('input[name="src"]',context).val(),title=$('input[name="imgtitle"]',context).val(),description=$('input[name="description"]',context).val(),width=$('input[name="width"]',context).val(),height=$('input[name="height"]',context).val(),styleFloat=$('select[name="float"]',context).val(),styles=[],style="",found,baseUrl;if(Wysiwyg.options.controlImage&&Wysiwyg.options.controlImage.forceRelativeUrls){baseUrl=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");if(0===url.indexOf(baseUrl)){url=url.substr(baseUrl.length)}}if(img.self){$(img.self).attr("src",url).attr("title",title).attr("alt",description).css("float",styleFloat);if(width.toString().match(/^[0-9]+(px|%)?$/)){$(img.self).css("width",width)}else{$(img.self).css("width","")}if(height.toString().match(/^[0-9]+(px|%)?$/)){$(img.self).css("height",height)}else{$(img.self).css("height","")}Wysiwyg.saveContent()}else{found=width.toString().match(/^[0-9]+(px|%)?$/);if(found){if(found[1]){styles.push("width: "+width+";")}else{styles.push("width: "+width+"px;")}}found=height.toString().match(/^[0-9]+(px|%)?$/);if(found){if(found[1]){styles.push("height: "+height+";")}else{styles.push("height: "+height+"px;")}}if(styleFloat.length>0){styles.push("float: "+styleFloat+";")}if(styles.length>0){style=' style="'+styles.join(" ")+'"'}image="<img src='"+url+"' title='"+title+"' alt='"+description+"'"+style+"/>";Wysiwyg.insertHtml(image)}},makeForm:function(form,img){form.find("input[name=src]").val(img.src);form.find("input[name=imgtitle]").val(img.title);form.find("input[name=description]").val(img.alt);form.find('input[name="width"]').val(img.width);form.find('input[name="height"]').val(img.height);form.find('select[name="float"]').val(img.styleFloat);form.find("img").attr("src",img.src);form.find("img").bind("load",function(){if(form.find("img").get(0).naturalWidth){form.find('input[name="naturalWidth"]').val(form.find("img").get(0).naturalWidth);form.find('input[name="naturalHeight"]').val(form.find("img").get(0).naturalHeight)}else if(form.find("img").attr("naturalWidth")){form.find('input[name="naturalWidth"]').val(form.find("img").attr("naturalWidth"));form.find('input[name="naturalHeight"]').val(form.find("img").attr("naturalHeight"))}});form.find("input[name=src]").bind("change",function(){form.find("img").attr("src",this.value)});return form}};$.wysiwyg.insertImage=function(object,url,attributes){return object.each(function(){var Wysiwyg=$(this).data("wysiwyg"),image,attribute;if(!Wysiwyg){return this}if(!url||url.length===0){return this}if($.browser.msie){Wysiwyg.ui.focus()}if(attributes){Wysiwyg.editorDoc.execCommand("insertImage",false,"#jwysiwyg#");
image=Wysiwyg.getElementByAttributeValue("img","src","#jwysiwyg#");if(image){image.src=url;for(attribute in attributes){if(attributes.hasOwnProperty(attribute)){image.setAttribute(attribute,attributes[attribute])}}}}else{Wysiwyg.editorDoc.execCommand("insertImage",false,url)}Wysiwyg.saveContent();$(Wysiwyg.editorDoc).trigger("editorRefresh.wysiwyg");return this})}})(jQuery);(function($){if(undefined===$.wysiwyg){throw"wysiwyg.cssWrap.js depends on $.wysiwyg"}if(!$.wysiwyg.controls){$.wysiwyg.controls={}}$.wysiwyg.controls.cssWrap={init:function(Wysiwyg){var self=this,formWrapHtml,key,translation,dialogReplacements={legend:"Wrap Element",wrapperType:"Wrapper Type",ID:"ID","class":"Class",wrap:"Wrap",unwrap:"Unwrap",cancel:"Cancel"};formWrapHtml='<form class="wysiwyg"><fieldset><legend>{legend}</legend>'+'<div class="wysiwyg-dialogRow"><label>{wrapperType}: &nbsp;<select name="type"><option value="span">Span</option><option value="div">Div</option></select></label></div>'+'<div class="wysiwyg-dialogRow"><label>{ID}: &nbsp;<input name="id" type="text" /></label></div>'+'<div class="wysiwyg-dialogRow"><label>{class}: &nbsp;<input name="class" type="text" /></label></div>'+'<div class="wysiwyg-dialogRow"><input type="button" class="button cssWrap-unwrap" style="display:none;" value="{unwrap}"/></label>'+'<input type="submit"  class="button cssWrap-submit" value="{wrap}"/></label>'+'<input type="reset" class="button cssWrap-cancel" value="{cancel}"/></div></fieldset></form>';for(key in dialogReplacements){if($.wysiwyg.i18n){translation=$.wysiwyg.i18n.t(dialogReplacements[key]);if(translation===dialogReplacements[key]){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs")}dialogReplacements[key]=translation}formWrapHtml=formWrapHtml.replace("{"+key+"}",dialogReplacements[key])}if(!$(".wysiwyg-dialog-wrapper").length){$(formWrapHtml).appendTo("body");$("form.wysiwyg").dialog({modal:true,open:function(ev,ui){var $this=$(this),range=Wysiwyg.getInternalRange(),common,$nodeName;if(range){if($.browser.msie){Wysiwyg.ui.focus()}common=$(range.commonAncestorContainer)}else{alert("You must select some elements before you can wrap them.");$this.dialog("close");return 0}$nodeName=range.commonAncestorContainer.nodeName.toLowerCase();if(common.parent(".wysiwygCssWrapper").length){alert(common.parent(".wysiwygCssWrapper").get(0).nodeName.toLowerCase());$this.find("select[name=type]").val(common.parent(".wysiwygCssWrapper").get(0).nodeName.toLowerCase());$this.find("select[name=type]").attr("disabled","disabled");$this.find("input[name=id]").val(common.parent(".wysiwygCssWrapper").attr("id"));$this.find("input[name=class]").val(common.parent(".wysiwygCssWrapper").attr("class").replace("wysiwygCssWrapper ",""));$("form.wysiwyg").find(".cssWrap-unwrap").show();$("form.wysiwyg").find(".cssWrap-unwrap").click(function(e){e.preventDefault();if($nodeName!=="body"){common.unwrap()}$this.dialog("close");return 1})}$("form.wysiwyg").find(".cssWrap-submit").click(function(e){e.preventDefault();var $wrapper=$("form.wysiwyg").find("select[name=type]").val(),$id=$("form.wysiwyg").find("input[name=id]").val(),$class=$("form.wysiwyg").find("input[name=class]").val();if($nodeName!=="body"){if(common.parent(".wysiwygCssWrapper").length){common.parent(".wysiwygCssWrapper").attr("id",$class);common.parent(".wysiwygCssWrapper").attr("class",$class)}else{common.wrap("<"+$wrapper+' id="'+$id+'" class="'+"wysiwygCssWrapper "+$class+'"/>')}}else{}$this.dialog("close")});$("form.wysiwyg").find(".cssWrap-cancel").click(function(e){e.preventDefault();$this.dialog("close");return 1})},close:function(){$(this).dialog("destroy");$(this).remove()}});Wysiwyg.saveContent()}$(Wysiwyg.editorDoc).trigger("editorRefresh.wysiwyg");return 1}}})(jQuery);(function($){"use strict";if(undefined===$.wysiwyg){throw"wysiwyg.colorpicker.js depends on $.wysiwyg"}if(!$.wysiwyg.controls){$.wysiwyg.controls={}}$.wysiwyg.controls.colorpicker={modalOpen:false,color:{back:{prev:"#ffffff",palette:[]},fore:{prev:"#123456",palette:[]}},addColorToPalette:function(type,color){if(-1===$.inArray(color,this.color[type].palette)){this.color[type].palette.push(color)}else{this.color[type].palette.sort(function(a,b){if(a===color){return 1}return 0})}},init:function(Wysiwyg){if($.wysiwyg.controls.colorpicker.modalOpen===true){return false}else{$.wysiwyg.controls.colorpicker.modalOpen=true}var self=this,elements,dialog,colorpickerHtml,dialogReplacements,key,translation;dialogReplacements={legend:"Colorpicker",color:"Color",submit:"Apply",reset:"Cancel"};colorpickerHtml='<form class="wysiwyg"><fieldset><legend>{legend}</legend>'+'<ul class="palette"></ul>'+'<label>{color}: <input type="text" name="color" value="#123456"/></label>'+'<div class="wheel"></div>'+'<input type="submit" class="button" value="{submit}"/> '+'<input type="reset" value="{reset}"/></fieldset></form>';for(key in dialogReplacements){if($.wysiwyg.i18n){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs.colorpicker");if(translation===dialogReplacements[key]){translation=$.wysiwyg.i18n.t(dialogReplacements[key],"dialogs")}dialogReplacements[key]=translation}colorpickerHtml=colorpickerHtml.replace("{"+key+"}",dialogReplacements[key])}if($.modal){elements=$(colorpickerHtml);if($.farbtastic){this.renderPalette(elements,"fore");elements.find(".wheel").farbtastic(elements.find("input:text"))}$.modal(elements.html(),{maxWidth:Wysiwyg.defaults.formWidth,maxHeight:Wysiwyg.defaults.formHeight,overlayClose:true,onShow:function(dialog){$("input:submit",dialog.data).click(function(e){var color=$('input[name="color"]',dialog.data).val();self.color.fore.prev=color;self.addColorToPalette("fore",color);if($.browser.msie){Wysiwyg.ui.returnRange()}Wysiwyg.editorDoc.execCommand("ForeColor",false,color);$.modal.close();return false});$("input:reset",dialog.data).click(function(e){if($.browser.msie){Wysiwyg.ui.returnRange()}$.modal.close();return false});$("fieldset",dialog.data).click(function(e){e.stopPropagation()})},onClose:function(dialog){$.wysiwyg.controls.colorpicker.modalOpen=false;$.modal.close()}})}else if($.fn.dialog){elements=$(colorpickerHtml);if($.farbtastic){this.renderPalette(elements,"fore");elements.find(".wheel").farbtastic(elements.find("input:text"))}dialog=elements.appendTo("body");dialog.dialog({modal:true,open:function(event,ui){$("input:submit",elements).click(function(e){var color=$('input[name="color"]',dialog).val();self.color.fore.prev=color;self.addColorToPalette("fore",color);if($.browser.msie){Wysiwyg.ui.returnRange()}Wysiwyg.editorDoc.execCommand("ForeColor",false,color);$(dialog).dialog("close");return false});$("input:reset",elements).click(function(e){if($.browser.msie){Wysiwyg.ui.returnRange()}$(dialog).dialog("close");return false});$("fieldset",elements).click(function(e){e.stopPropagation()})},close:function(event,ui){$.wysiwyg.controls.colorpicker.modalOpen=false;dialog.dialog("destroy");dialog.remove()}})}else{if($.farbtastic){elements=$("<div/>").css({position:"fixed","z-index":2e3,left:"50%",top:"50%",background:"rgb(0, 0, 0)","margin-top":-1*Math.round(Wysiwyg.defaults.formHeight/2),"margin-left":-1*Math.round(Wysiwyg.defaults.formWidth/2)}).html(colorpickerHtml);this.renderPalette(elements,"fore");elements.find("input[name=color]").val(self.color.fore.prev);elements.find(".wheel").farbtastic(elements.find("input:text"));$("input:submit",elements).click(function(event){var color=$('input[name="color"]',elements).val();self.color.fore.prev=color;self.addColorToPalette("fore",color);if($.browser.msie){Wysiwyg.ui.returnRange()}Wysiwyg.editorDoc.execCommand("ForeColor",false,color);$(elements).remove();$.wysiwyg.controls.colorpicker.modalOpen=false;return false});$("input:reset",elements).click(function(event){if($.browser.msie){Wysiwyg.ui.returnRange()}$(elements).remove();$.wysiwyg.controls.colorpicker.modalOpen=false;return false});$("body").append(elements);elements.click(function(e){e.stopPropagation()})}}},renderPalette:function(jqObj,type){var palette=jqObj.find(".palette"),bind=function(){var color=$(this).text();jqObj.find("input[name=color]").val(color);if($.farbtastic){jqObj.find("input[name=color]").trigger("keyup")}},colorExample,colorSelect,i;for(i=this.color[type].palette.length-1;i>-1;i-=1){colorExample=$("<div/>").css({"float":"left",width:"16px",height:"16px",margin:"0px 5px 0px 0px","background-color":this.color[type].palette[i]});colorSelect=$("<li>"+this.color[type].palette[i]+"</li>").css({"float":"left","list-style":"none"}).append(colorExample).bind("click.wysiwyg",bind);palette.append(colorSelect).css({margin:"0px",padding:"0px"})}}}})(jQuery);